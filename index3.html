<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dhumketu Master Admin | Complete Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; scroll-behavior: smooth; }
        .admin-section { display: none; }
        .admin-section.active { display: block; }
        .nav-btn-active { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border-radius: 14px; box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.4); transform: translateY(-2px); }
        .select-custom { background: #1e293b; border: 2px solid #334155; padding: 14px; border-radius: 14px; width: 100%; outline: none; color: white; transition: 0.3s; }
        .select-custom:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        .input-custom { background: #0f172a; border: 2px solid #334155; padding: 14px; border-radius: 14px; width: 100%; outline: none; color: white; transition: 0.3s; }
        .input-custom:focus { border-color: #8b5cf6; }
        .tab-btn { transition: all 0.3s ease; }
        .tab-active { background: linear-gradient(135deg, #8b5cf6, #6d28d9); color: white; }
        .q-block { animation: slideIn 0.3s ease-out; border-left: 4px solid #8b5cf6; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .class-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; margin: 2px; }
        .drop-zone { border: 3px dashed #4b5563; border-radius: 16px; padding: 40px; text-align: center; transition: all 0.3s; }
        .drop-zone.active { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .drop-zone.dragover { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-gray-900 text-slate-200">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
        <aside class="w-full md:w-80 bg-gradient-to-b from-slate-800 to-slate-900 p-6 flex flex-col gap-3 border-r border-slate-700 shadow-2xl">
            <div class="mb-8 px-4">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                        <span class="text-white font-black text-xl">D</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-black text-blue-400 italic uppercase tracking-tighter">Dhumketu AI</h1>
                        <p class="text-[10px] text-slate-400 font-bold tracking-widest">COMPLETE MANAGEMENT</p>
                    </div>
                </div>
                <p class="text-xs text-slate-500 mt-4">Version 5.0 | JSON Support</p>
            </div>
            
            <nav class="flex flex-col gap-2">
                <button onclick="showSection('class-sec', this)" class="nav-btn nav-btn-active flex items-center gap-4 p-4 text-sm font-bold transition-all text-left hover:bg-slate-700/50 rounded-xl">
                    <span class="text-xl">üè´</span>
                    <div>
                        <div class="text-green-300">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                        <div class="text-[10px] text-green-400">Class Setup</div>
                    </div>
                </button>
                
                <button onclick="showSection('subject-sec', this)" class="nav-btn flex items-center gap-4 p-4 text-sm font-bold transition-all text-left hover:bg-slate-700/50 rounded-xl">
                    <span class="text-xl">üìö</span>
                    <div>
                        <div>‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                        <div class="text-[10px] text-slate-400">Subject & Chapter</div>
                    </div>
                </button>
                
                <button onclick="showSection('mcqset-sec', this)" class="nav-btn flex items-center gap-4 p-4 text-sm font-bold transition-all text-left hover:bg-slate-700/50 rounded-xl">
                    <span class="text-xl">üìù</span>
                    <div>
                        <div class="text-purple-300">MCQ ‡¶∏‡ßá‡¶ü ‡¶§‡ßà‡¶∞‡¶ø</div>
                        <div class="text-[10px] text-purple-400">25-30 Questions</div>
                    </div>
                </button>
                
                <button onclick="showSection('json-sec', this)" class="nav-btn flex items-center gap-4 p-4 text-sm font-bold transition-all text-left hover:bg-slate-700/50 rounded-xl">
                    <span class="text-xl">üìÅ</span>
                    <div>
                        <div class="text-amber-300">JSON ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</div>
                        <div class="text-[10px] text-amber-400">Bulk Upload</div>
                    </div>
                </button>
                
                <button onclick="showSection('magic-sec', this)" class="nav-btn flex items-center gap-4 p-4 text-sm font-bold transition-all text-left hover:bg-slate-700/50 rounded-xl">
                    <span class="text-xl">‚ú®</span>
                    <div>
                        <div class="text-indigo-300">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡¶ø‡¶ï ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞</div>
                        <div class="text-[10px] text-indigo-400">AI Scanner</div>
                    </div>
                </button>
                
                <button onclick="showSection('settings-sec', this)" class="nav-btn flex items-center gap-4 p-4 text-sm font-bold transition-all text-left hover:bg-slate-700/50 rounded-xl">
                    <span class="text-xl">‚öôÔ∏è</span>
                    <div>
                        <div>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</div>
                        <div class="text-[10px] text-slate-400">System Settings</div>
                    </div>
                </button>
            </nav>
            
            <div class="mt-auto pt-8 border-t border-slate-700">
                <div class="text-xs text-slate-500">
                    <div class="flex justify-between mb-2">
                        <span>Classes:</span>
                        <span id="class-count">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Storage:</span>
                        <span id="storage-used">0%</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            <!-- Class Management Section -->
            <section id="class-sec" class="admin-section active">
                <div class="flex items-center gap-4 mb-8">
                    <div class="p-3 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl">
                        <span class="text-2xl">üè´</span>
                    </div>
                    <div>
                        <h2 class="text-3xl font-black text-green-300">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
                        <p class="text-emerald-400">Create and manage educational classes</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Add New Class -->
                    <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-8 rounded-2xl border border-slate-700">
                        <h3 class="text-xl font-bold mb-6 text-blue-300">‡¶®‡¶§‡ßÅ‡¶® ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-bold mb-3 text-slate-300">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶ï‡ßã‡¶° *</label>
                                <input id="class_code" type="text" class="input-custom" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: nine, ten, eleven">
                                <p class="text-xs text-slate-500 mt-2">‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶õ‡ßã‡¶ü ‡¶π‡¶æ‡¶§‡ßá‡¶∞ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-3 text-slate-300">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ) *</label>
                                <input id="class_name_bn" type="text" class="input-custom" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶®‡¶¨‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-3 text-slate-300">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø)</label>
                                <input id="class_name_en" type="text" class="input-custom" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: Class Nine">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold mb-3 text-slate-300">‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ</label>
                                <textarea id="class_description" rows="3" class="input-custom" placeholder="‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ..."></textarea>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-slate-300">‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º</label>
                                    <input id="class_main_subject" type="text" class="input-custom" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®, ‡¶Æ‡¶æ‡¶®‡¶¨‡¶ø‡¶ï">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-3 text-slate-300">‡¶õ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</label>
                                    <input id="class_student_count" type="number" class="input-custom" placeholder="0" value="0">
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-4">
                                <div class="flex items-center gap-2">
                                    <input type="checkbox" id="class_active" class="w-5 h-5" checked>
                                    <label for="class_active" class="text-sm">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</label>
                                </div>
                                
                                <div class="flex items-center gap-2">
                                    <input type="checkbox" id="class_featured" class="w-5 h-5">
                                    <label for="class_featured" class="text-sm">‡¶´‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶°</label>
                                </div>
                            </div>
                            
                            <button onclick="addNewClass()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 p-4 rounded-xl font-bold hover:scale-[1.02] transition">
                                ‚ûï ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                    </div>
                    
                    <!-- Manage Classes -->
                    <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-8 rounded-2xl border border-slate-700">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-purple-300">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
                            <span class="text-sm text-slate-400" id="total-classes">0 Classes</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div id="classes-list" class="space-y-3 max-h-[500px] overflow-y-auto p-2">
                                <div class="text-center py-12 text-slate-500">
                                    <div class="text-4xl mb-4">üè´</div>
                                    <p>‡¶ï‡ßã‡¶® ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡ßá‡¶á</p>
                                    <p class="text-sm text-slate-600 mt-2">‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Class Statistics -->
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-8 rounded-2xl border border-slate-700">
                    <h3 class="text-xl font-bold mb-6 text-amber-300">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="p-4 bg-slate-900/50 rounded-xl">
                            <div class="text-2xl font-black text-blue-400 mb-2" id="stat-class-count">0</div>
                            <div class="text-sm font-medium text-slate-300">‡¶Æ‡ßã‡¶ü ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ</div>
                        </div>
                        
                        <div class="p-4 bg-slate-900/50 rounded-xl">
                            <div class="text-2xl font-black text-green-400 mb-2" id="stat-active-classes">0</div>
                            <div class="text-sm font-medium text-slate-300">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ</div>
                        </div>
                        
                        <div class="p-4 bg-slate-900/50 rounded-xl">
                            <div class="text-2xl font-black text-purple-400 mb-2" id="stat-subject-count">0</div>
                            <div class="text-sm font-medium text-slate-300">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º</div>
                        </div>
                        
                        <div class="p-4 bg-slate-900/50 rounded-xl">
                            <div class="text-2xl font-black text-yellow-400 mb-2" id="stat-mcq-count">0</div>
                            <div class="text-sm font-medium text-slate-300">MCQ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- JSON Upload Section -->
            <section id="json-sec" class="admin-section">
                <div class="flex items-center gap-4 mb-8">
                    <div class="p-3 bg-gradient-to-br from-amber-500 to-yellow-600 rounded-xl">
                        <span class="text-2xl">üìÅ</span>
                    </div>
                    <div>
                        <h2 class="text-3xl font-black text-amber-300">JSON MCQ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</h2>
                        <p class="text-yellow-400">Bulk upload MCQ questions from JSON files</p>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-8 rounded-2xl border border-slate-700 mb-8">
                    <h3 class="text-xl font-bold mb-6 text-blue-300">JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</h3>
                    
                    <!-- Upload Methods -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-900/30 p-6 rounded-2xl border border-blue-500/30">
                            <div class="text-3xl mb-3">üìÅ</div>
                            <h4 class="font-bold mb-2 text-blue-300">‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</h4>
                            <p class="text-sm text-blue-400 mb-4">JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                            <input type="file" id="json-file-input" accept=".json,application/json" class="w-full text-sm text-slate-400 file:bg-blue-600 file:border-0 file:px-4 file:py-2 file:rounded-xl file:text-white">
                        </div>
                        
                        <div class="bg-purple-900/30 p-6 rounded-2xl border border-purple-500/30">
                            <div class="text-3xl mb-3">üìã</div>
                            <h4 class="font-bold mb-2 text-purple-300">‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶™‡ßá‡¶∏‡ßç‡¶ü</h4>
                            <p class="text-sm text-purple-400 mb-4">JSON ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                            <button onclick="showJsonPaste()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 px-4 py-2 rounded-xl font-bold text-sm">
                                JSON ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                        
                        <div class="bg-green-900/30 p-6 rounded-2xl border border-green-500/30">
                            <div class="text-3xl mb-3">üìñ</div>
                            <h4 class="font-bold mb-2 text-green-300">‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü</h4>
                            <p class="text-sm text-green-400 mb-4">JSON ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</p>
                            <button onclick="showJsonTemplate()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 px-4 py-2 rounded-xl font-bold text-sm">
                                ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                            </button>
                        </div>
                    </div>
                    
                    <!-- Drop Zone -->
                    <div id="json-drop-zone" class="drop-zone mb-8">
                        <div class="text-5xl mb-4">üìÅ</div>
                        <h4 class="text-xl font-bold mb-2 text-slate-300">JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡ßç‡¶∞‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                        <p class="text-slate-400 mb-4">‡¶¨‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        <input type="file" id="json-drop-input" accept=".json,application/json" class="hidden">
                        <button onclick="document.getElementById('json-drop-input').click()" class="bg-gradient-to-r from-blue-600 to-cyan-600 px-6 py-3 rounded-xl font-bold">
                            ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                        <p class="text-xs text-slate-500 mt-4">‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶ø‡¶§ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü: JSON</p>
                    </div>
                    
                    <!-- Upload Progress -->
                    <div id="upload-progress" class="hidden">
                        <div class="flex justify-between text-sm text-slate-400 mb-2">
                            <span>‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏</span>
                            <span id="progress-percent">0%</span>
                        </div>
                        <div class="h-3 bg-slate-700 rounded-full overflow-hidden">
                            <div id="progress-bar" class="h-full bg-gradient-to-r from-green-500 to-emerald-500" style="width: 0%"></div>
                        </div>
                        <div id="progress-details" class="text-sm text-slate-400 mt-2">
                            ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç...
                        </div>
                    </div>
                </div>
                
                <!-- JSON Parser Settings -->
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-8 rounded-2xl border border-slate-700 mb-8">
                    <h3 class="text-xl font-bold mb-6 text-purple-300">JSON ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-bold mb-3 text-slate-300">‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ *</label>
                            <select id="json_class" class="select-custom" onchange="updateJsonSubjectList()">
                                <option value="">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-3 text-slate-300">‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º *</label>
                            <select id="json_subject" class="select-custom">
                                <option value="">‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-3 text-slate-300">‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º</label>
                            <input id="json_chapter" type="text" class="input-custom" placeholder="‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-3 text-slate-300">‡¶ï‡¶†‡¶ø‡¶®‡¶§‡¶æ</label>
                            <select id="json_difficulty" class="select-custom">
                                <option value="medium">Medium</option>
                                <option value="easy">Easy</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-bold mb-3 text-slate-300">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞</label>
                        <select id="json_folder" class="select-custom">
                            <option value="">‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center gap-4 mb-6">
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="json_create_set" class="w-5 h-5" checked>
                            <label for="json_create_set" class="text-sm">MCQ ‡¶∏‡ßá‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="json_overwrite" class="w-5 h-5">
                            <label for="json_overwrite" class="text-sm">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ì‡¶≠‡¶æ‡¶∞‡¶∞‡¶æ‡¶á‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                        </div>
                    </div>
                    
                    <button onclick="processJsonUpload()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 p-4 rounded-xl font-bold text-lg hover:scale-[1.02] transition">
                        üöÄ JSON ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </div>
                
                <!-- JSON Template Modal -->
                <div id="json-template-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
                    <div class="bg-slate-800 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                        <div class="p-6 border-b border-slate-700 flex justify-between items-center">
                            <h3 class="text-xl font-bold text-amber-300">JSON ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü</h3>
                            <button onclick="hideJsonTemplate()" class="text-2xl text-slate-400 hover:text-white">&times;</button>
                        </div>
                        <div class="p-6 overflow-y-auto max-h-[70vh]">
                            <pre class="bg-slate-900 p-6 rounded-xl text-sm overflow-x-auto text-slate-300">
{
  "setInfo": {
    "title": "‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡ßß‡¶Æ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º MCQ ‡¶∏‡ßá‡¶ü",
    "description": "‡¶¨‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®",
    "class": "nine",
    "subject": "physics",
    "chapter": "‡¶¨‡¶≤",
    "difficulty": "medium"
  },
  "questions": [
    {
      "id": 1,
      "title": "‡¶®‡¶ø‡¶â‡¶ü‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ó‡¶§‡¶ø‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?",
      "description": "‡¶ú‡¶°‡¶º‡¶§‡¶æ‡¶∞ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®",
      "options": {
        "A": "‡¶¨‡¶≤‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶®‡ßÅ‡¶™‡¶æ‡¶§‡¶ø‡¶ï",
        "B": "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£",
        "C": "‡¶ú‡¶°‡¶º‡¶§‡¶æ",
        "D": "‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ-‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ"
      },
      "answer": "C",
      "explanation": "‡¶®‡¶ø‡¶â‡¶ü‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ó‡¶§‡¶ø‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶ú‡¶°‡¶º‡¶§‡¶æ‡¶∞ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßá ‡¶™‡¶∞‡¶ø‡¶ö‡¶ø‡¶§",
      "difficulty": "easy",
      "marks": 1
    },
    {
      "id": 2,
      "title": "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶ï‡¶æ‡¶∞?",
      "description": "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®",
      "options": {
        "A": "‡¶®‡¶ø‡¶â‡¶ü‡¶®",
        "B": "‡¶Ü‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶®",
        "C": "‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶≤‡¶ø‡¶ì",
        "D": "‡¶ï‡ßá‡¶™‡¶≤‡¶æ‡¶∞"
      },
      "answer": "A",
      "explanation": "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶â‡¶ü‡¶®‡ßá‡¶∞",
      "difficulty": "medium",
      "marks": 1
    }
  ]
}

<b>‡¶Ö‡¶•‡¶¨‡¶æ</b>

{
  "singleMCQs": [
    {
      "title": "‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü",
      "description": "‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ",
      "class": "ten",
      "subject": "math",
      "chapter": "‡¶¨‡ßÄ‡¶ú‡¶ó‡¶£‡¶ø‡¶§",
      "difficulty": "easy",
      "options": {
        "A": "‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶Ö‡¶™‡¶∂‡¶®",
        "B": "‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º ‡¶Ö‡¶™‡¶∂‡¶®",
        "C": "‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶Ö‡¶™‡¶∂‡¶®",
        "D": "‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶• ‡¶Ö‡¶™‡¶∂‡¶®"
      },
      "answer": "A",
      "explanation": "‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ"
    }
  ]
}
                            </pre>
                            <div class="mt-6 p-4 bg-amber-900/30 rounded-xl border border-amber-500/30">
                                <h4 class="font-bold text-amber-300 mb-2">‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                                <button onclick="downloadJsonTemplate()" class="bg-gradient-to-r from-amber-600 to-yellow-600 px-6 py-2 rounded-xl font-bold">
                                    üì• ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- JSON Paste Modal -->
                <div id="json-paste-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
                    <div class="bg-slate-800 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                        <div class="p-6 border-b border-slate-700 flex justify-between items-center">
                            <h3 class="text-xl font-bold text-purple-300">JSON ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                            <button onclick="hideJsonPaste()" class="text-2xl text-slate-400 hover:text-white">&times;</button>
                        </div>
                        <div class="p-6">
                            <textarea id="json-paste-area" rows="15" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-sm font-mono text-slate-300" placeholder="JSON ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®..."></textarea>
                            <div class="flex gap-4 mt-6">
                                <button onclick="processPastedJson()" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 p-4 rounded-xl font-bold">
                                    ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®
                                </button>
                                <button onclick="hideJsonPaste()" class="flex-1 bg-gradient-to-r from-slate-700 to-slate-800 p-4 rounded-xl font-bold border border-slate-600">
                                    ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // ============ FIREBASE CONFIG ============
        const firebaseConfig = {
            apiKey: "AIzaSyBrmy4wHPsvObbdl6ZEVOOJ1JvLK1xs-hw",
            databaseURL: "https://dhumketu2-fa6f0-default-rtdb.firebaseio.com",
            projectId: "dhumketu2-fa6f0"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // ============ GLOBAL VARIABLES ============
        let classesList = [];
        let currentJsonData = null;

        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data
            loadClasses();
            loadFolders();
            setupDropZone();
            
            // Set current time
            setInterval(() => {
                const now = new Date();
                document.getElementById('last-update-time').textContent = 
                    now.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit' });
            }, 60000);
        });

        // ============ NAVIGATION ============
        function showSection(id, btn) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-btn-active'));
            
            // Show selected section
            document.getElementById(id).classList.add('active');
            if(btn) btn.classList.add('nav-btn-active');
            
            // Load data for specific sections
            if(id === 'class-sec') {
                loadClasses();
                loadClassStats();
            } else if(id === 'json-sec') {
                loadClasses();
                loadFolders();
            }
        }

        // ============ CLASS MANAGEMENT ============
        function loadClasses() {
            const classesDiv = document.getElementById('classes-list');
            classesDiv.innerHTML = '<div class="text-center py-8 text-slate-500">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>';
            
            db.ref('classes').once('value', snapshot => {
                const data = snapshot.val();
                classesList = [];
                
                if(data) {
                    Object.keys(data).forEach(key => {
                        classesList.push({
                            id: key,
                            ...data[key]
                        });
                    });
                    
                    // Sort by creation time
                    classesList.sort((a, b) => b.createdAt - a.createdAt);
                }
                
                displayClasses();
                updateClassDropdowns();
                loadClassStats();
            });
        }

        function displayClasses() {
            const classesDiv = document.getElementById('classes-list');
            const totalClasses = document.getElementById('total-classes');
            
            if(classesList.length === 0) {
                classesDiv.innerHTML = `
                    <div class="text-center py-12 text-slate-500">
                        <div class="text-4xl mb-4">üè´</div>
                        <p>‡¶ï‡ßã‡¶® ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡ßá‡¶á</p>
                        <p class="text-sm text-slate-600 mt-2">‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    </div>
                `;
                totalClasses.textContent = "0 Classes";
                return;
            }
            
            classesDiv.innerHTML = '';
            totalClasses.textContent = `${classesList.length} Classes`;
            
            classesList.forEach(cls => {
                const classDiv = document.createElement('div');
                classDiv.className = `p-4 bg-slate-900/50 rounded-xl border ${cls.active ? 'border-green-500/30' : 'border-slate-700'}`;
                
                const classColor = getClassColor(cls.code);
                
                classDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-bold text-slate-200">${cls.name_bn}</h4>
                            <p class="text-sm text-slate-400">${cls.name_en || cls.code}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            ${cls.active ? '<span class="text-xs bg-green-900/50 text-green-300 px-2 py-1 rounded">Active</span>' : ''}
                            ${cls.featured ? '<span class="text-xs bg-yellow-900/50 text-yellow-300 px-2 py-1 rounded">Featured</span>' : ''}
                            <button onclick="editClass('${cls.id}')" class="text-blue-400 hover:text-blue-300">‚úèÔ∏è</button>
                            <button onclick="deleteClass('${cls.id}')" class="text-red-400 hover:text-red-300">üóëÔ∏è</button>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-4 mb-3">
                        <span class="class-badge ${classColor}">${cls.code}</span>
                        ${cls.main_subject ? `<span class="text-xs bg-blue-900/50 text-blue-300 px-2 py-1 rounded">${cls.main_subject}</span>` : ''}
                        <span class="text-xs text-slate-500">${cls.student_count || 0} Students</span>
                    </div>
                    
                    ${cls.description ? `<p class="text-sm text-slate-400 mb-2">${cls.description}</p>` : ''}
                    
                    <div class="text-xs text-slate-500">
                        Created: ${new Date(cls.createdAt).toLocaleDateString('bn-BD')}
                    </div>
                `;
                
                classesDiv.appendChild(classDiv);
            });
        }

        function getClassColor(classCode) {
            const colors = {
                'nine': 'bg-blue-100 text-blue-800',
                'ten': 'bg-green-100 text-green-800',
                'eleven': 'bg-purple-100 text-purple-800',
                'twelve': 'bg-red-100 text-red-800',
                'hsc': 'bg-indigo-100 text-indigo-800',
                'ssc': 'bg-amber-100 text-amber-800',
                'admission': 'bg-pink-100 text-pink-800'
            };
            return colors[classCode] || 'bg-gray-100 text-gray-800';
        }

        function addNewClass() {
            const code = document.getElementById('class_code').value.trim().toLowerCase();
            const nameBn = document.getElementById('class_name_bn').value.trim();
            const nameEn = document.getElementById('class_name_en').value.trim();
            const description = document.getElementById('class_description').value.trim();
            const mainSubject = document.getElementById('class_main_subject').value.trim();
            const studentCount = parseInt(document.getElementById('class_student_count').value) || 0;
            const active = document.getElementById('class_active').checked;
            const featured = document.getElementById('class_featured').checked;
            
            // Validation
            if(!code || !nameBn) {
                alert("‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶®‡¶æ‡¶Æ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
                return;
            }
            
            // Check if class already exists
            if(classesList.some(cls => cls.code === code)) {
                alert("‡¶è‡¶á ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ü‡¶õ‡ßá!");
                return;
            }
            
            const classData = {
                code: code,
                name_bn: nameBn,
                name_en: nameEn || code,
                description: description || null,
                main_subject: mainSubject || null,
                student_count: studentCount,
                active: active,
                featured: featured,
                createdAt: Date.now(),
                updatedAt: Date.now()
            };
            
            // Save to Firebase
            const newRef = db.ref('classes').push();
            classData.id = newRef.key;
            
            newRef.set(classData).then(() => {
                alert("‚úÖ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                
                // Clear form
                document.getElementById('class_code').value = '';
                document.getElementById('class_name_bn').value = '';
                document.getElementById('class_name_en').value = '';
                document.getElementById('class_description').value = '';
                document.getElementById('class_main_subject').value = '';
                document.getElementById('class_student_count').value = '0';
                
                // Reload classes
                loadClasses();
                
            }).catch(error => {
                alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: " + error.message);
            });
        }

        function editClass(classId) {
            const cls = classesList.find(c => c.id === classId);
            if(!cls) return;
            
            // Fill form with class data
            document.getElementById('class_code').value = cls.code;
            document.getElementById('class_name_bn').value = cls.name_bn;
            document.getElementById('class_name_en').value = cls.name_en || '';
            document.getElementById('class_description').value = cls.description || '';
            document.getElementById('class_main_subject').value = cls.main_subject || '';
            document.getElementById('class_student_count').value = cls.student_count || 0;
            document.getElementById('class_active').checked = cls.active || false;
            document.getElementById('class_featured').checked = cls.featured || false;
            
            // Change button text
            const submitBtn = document.querySelector('#class-sec button[onclick="addNewClass()"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = "üîÑ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
            submitBtn.onclick = function() { updateClass(classId); };
            
            // Store original function
            submitBtn.dataset.original = originalText;
        }

        function updateClass(classId) {
            const code = document.getElementById('class_code').value.trim().toLowerCase();
            const nameBn = document.getElementById('class_name_bn').value.trim();
            const nameEn = document.getElementById('class_name_en').value.trim();
            const description = document.getElementById('class_description').value.trim();
            const mainSubject = document.getElementById('class_main_subject').value.trim();
            const studentCount = parseInt(document.getElementById('class_student_count').value) || 0;
            const active = document.getElementById('class_active').checked;
            const featured = document.getElementById('class_featured').checked;
            
            // Validation
            if(!code || !nameBn) {
                alert("‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶®‡¶æ‡¶Æ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
                return;
            }
            
            const classData = {
                code: code,
                name_bn: nameBn,
                name_en: nameEn || code,
                description: description || null,
                main_subject: mainSubject || null,
                student_count: studentCount,
                active: active,
                featured: featured,
                updatedAt: Date.now()
            };
            
            // Update in Firebase
            db.ref(`classes/${classId}`).update(classData).then(() => {
                alert("‚úÖ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                
                // Reset form and button
                const submitBtn = document.querySelector('#class-sec button[onclick="updateClass(\'' + classId + '\')"]');
                submitBtn.innerHTML = submitBtn.dataset.original;
                submitBtn.onclick = function() { addNewClass(); };
                
                // Clear form
                document.getElementById('class_code').value = '';
                document.getElementById('class_name_bn').value = '';
                document.getElementById('class_name_en').value = '';
                document.getElementById('class_description').value = '';
                document.getElementById('class_main_subject').value = '';
                document.getElementById('class_student_count').value = '0';
                document.getElementById('class_active').checked = true;
                document.getElementById('class_featured').checked = false;
                
                // Reload classes
                loadClasses();
                
            }).catch(error => {
                alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: " + error.message);
            });
        }

        function deleteClass(classId) {
            if(confirm("‡¶è‡¶á ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶è‡¶¨‡¶Ç MCQ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ì ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶¨‡ßá!")) {
                db.ref(`classes/${classId}`).remove().then(() => {
                    alert("‚úÖ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                    loadClasses();
                }).catch(error => {
                    alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: " + error.message);
                });
            }
        }

        function updateClassDropdowns() {
            const classDropdown = document.getElementById('json_class');
            classDropdown.innerHTML = '<option value="">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            
            classesList.forEach(cls => {
                if(cls.active) {
                    classDropdown.innerHTML += `<option value="${cls.code}">${cls.name_bn} (${cls.code})</option>`;
                }
            });
        }

        function updateJsonSubjectList() {
            const classCode = document.getElementById('json_class').value;
            const subjectDropdown = document.getElementById('json_subject');
            
            if(!classCode) {
                subjectDropdown.innerHTML = '<option value="">‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
                return;
            }
            
            // In a real app, you would load subjects from Firebase based on class
            // For now, show common subjects
            const subjects = {
                'physics': '‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®',
                'chemistry': '‡¶∞‡¶∏‡¶æ‡¶Ø‡¶º‡¶®',
                'math': '‡¶ó‡¶£‡¶ø‡¶§',
                'biology': '‡¶ú‡ßÄ‡¶¨‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®',
                'bangla': '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ',
                'english': '‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø',
                'ict': '‡¶§‡¶•‡ßç‡¶Ø ‡¶ì ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø'
            };
            
            subjectDropdown.innerHTML = '<option value="">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            Object.keys(subjects).forEach(code => {
                subjectDropdown.innerHTML += `<option value="${code}">${subjects[code]}</option>`;
            });
        }

        function loadClassStats() {
            // Update class count
            document.getElementById('class-count').textContent = classesList.length;
            document.getElementById('stat-class-count').textContent = classesList.length;
            
            // Count active classes
            const activeClasses = classesList.filter(cls => cls.active);
            document.getElementById('stat-active-classes').textContent = activeClasses.length;
            
            // Load other stats from Firebase
            db.ref('qbank').once('value', snapshot => {
                const data = snapshot.val();
                let subjectCount = 0;
                let mcqCount = 0;
                let subjects = new Set();
                
                function countStats(obj) {
                    if(!obj) return;
                    
                    for(let key in obj) {
                        if(obj[key] && typeof obj[key] === 'object') {
                            if(obj[key].type === 'mcq' || obj[key].type === 'mcq_set') {
                                mcqCount++;
                                if(obj[key].subject) subjects.add(obj[key].subject);
                            }
                            countStats(obj[key]);
                        }
                    }
                }
                
                countStats(data);
                
                document.getElementById('stat-subject-count').textContent = subjects.size;
                document.getElementById('stat-mcq-count').textContent = mcqCount;
            });
        }

        // ============ JSON UPLOAD FUNCTIONS ============
        function setupDropZone() {
            const dropZone = document.getElementById('json-drop-zone');
            const fileInput = document.getElementById('json-drop-input');
            
            // Click to select file
            dropZone.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Drag and drop events
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.classList.add('dragover');
            }
            
            function unhighlight() {
                dropZone.classList.remove('dragover');
            }
            
            // Handle dropped files
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if(files.length > 0) {
                    handleJsonFile(files[0]);
                }
            }
            
            // Handle file input change
            fileInput.addEventListener('change', function(e) {
                if(this.files.length > 0) {
                    handleJsonFile(this.files[0]);
                }
            });
        }

        function handleJsonFile(file) {
            if(!file.name.endsWith('.json')) {
                alert("‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®!");
                return;
            }
            
            const dropZone = document.getElementById('json-drop-zone');
            dropZone.classList.add('active');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    currentJsonData = jsonData;
                    
                    // Update drop zone with file info
                    dropZone.innerHTML = `
                        <div class="text-4xl mb-3">‚úÖ</div>
                        <h4 class="text-lg font-bold mb-1 text-green-300">${file.name}</h4>
                        <p class="text-sm text-slate-400 mb-2">${(file.size / 1024).toFixed(2)} KB</p>
                        <p class="text-sm text-green-400">‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</p>
                        <button onclick="resetDropZone()" class="mt-4 text-sm text-slate-400 hover:text-white">
                            ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                    `;
                    
                    // Auto-fill form if data has class/subject info
                    if(jsonData.setInfo) {
                        if(jsonData.setInfo.class) {
                            document.getElementById('json_class').value = jsonData.setInfo.class;
                            updateJsonSubjectList();
                        }
                        if(jsonData.setInfo.subject) {
                            document.getElementById('json_subject').value = jsonData.setInfo.subject;
                        }
                        if(jsonData.setInfo.chapter) {
                            document.getElementById('json_chapter').value = jsonData.setInfo.chapter;
                        }
                        if(jsonData.setInfo.difficulty) {
                            document.getElementById('json_difficulty').value = jsonData.setInfo.difficulty;
                        }
                    }
                    
                } catch(error) {
                    alert("JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: " + error.message);
                    resetDropZone();
                }
            };
            
            reader.onerror = function() {
                alert("‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶°‡¶º‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!");
                resetDropZone();
            };
            
            reader.readAsText(file);
        }

        function resetDropZone() {
            const dropZone = document.getElementById('json-drop-zone');
            dropZone.classList.remove('active');
            dropZone.innerHTML = `
                <div class="text-5xl mb-4">üìÅ</div>
                <h4 class="text-xl font-bold mb-2 text-slate-300">JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡ßç‡¶∞‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                <p class="text-slate-400 mb-4">‡¶¨‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                <button onclick="document.getElementById('json-drop-input').click()" class="bg-gradient-to-r from-blue-600 to-cyan-600 px-6 py-3 rounded-xl font-bold">
                    ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
                <p class="text-xs text-slate-500 mt-4">‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶ø‡¶§ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü: JSON</p>
            `;
            currentJsonData = null;
        }

        function showJsonTemplate() {
            document.getElementById('json-template-modal').classList.remove('hidden');
        }

        function hideJsonTemplate() {
            document.getElementById('json-template-modal').classList.add('hidden');
        }

        function showJsonPaste() {
            document.getElementById('json-paste-modal').classList.remove('hidden');
        }

        function hideJsonPaste() {
            document.getElementById('json-paste-modal').classList.add('hidden');
        }

        function processPastedJson() {
            const jsonText = document.getElementById('json-paste-area').value.trim();
            
            if(!jsonText) {
                alert("JSON ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®!");
                return;
            }
            
            try {
                const jsonData = JSON.parse(jsonText);
                currentJsonData = jsonData;
                
                // Auto-fill form if data has class/subject info
                if(jsonData.setInfo) {
                    if(jsonData.setInfo.class) {
                        document.getElementById('json_class').value = jsonData.setInfo.class;
                        updateJsonSubjectList();
                    }
                    if(jsonData.setInfo.subject) {
                        document.getElementById('json_subject').value = jsonData.setInfo.subject;
                    }
                    if(jsonData.setInfo.chapter) {
                        document.getElementById('json_chapter').value = jsonData.setInfo.chapter;
                    }
                    if(jsonData.setInfo.difficulty) {
                        document.getElementById('json_difficulty').value = jsonData.setInfo.difficulty;
                    }
                }
                
                alert("‚úÖ JSON ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶∞‡ßç‡¶∏ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                hideJsonPaste();
                
            } catch(error) {
                alert("JSON ‡¶™‡¶æ‡¶∞‡ßç‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: " + error.message);
            }
        }

        function downloadJsonTemplate() {
            const template = {
                setInfo: {
                    title: "‡¶™‡¶¶‡¶æ‡¶∞‡ßç‡¶•‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡ßß‡¶Æ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º MCQ ‡¶∏‡ßá‡¶ü",
                    description: "‡¶¨‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®",
                    class: "nine",
                    subject: "physics",
                    chapter: "‡¶¨‡¶≤",
                    difficulty: "medium"
                },
                questions: [
                    {
                        id: 1,
                        title: "‡¶®‡¶ø‡¶â‡¶ü‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ó‡¶§‡¶ø‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?",
                        description: "‡¶ú‡¶°‡¶º‡¶§‡¶æ‡¶∞ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®",
                        options: {
                            A: "‡¶¨‡¶≤‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶®‡ßÅ‡¶™‡¶æ‡¶§‡¶ø‡¶ï",
                            B: "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£",
                            C: "‡¶ú‡¶°‡¶º‡¶§‡¶æ",
                            D: "‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ-‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ"
                        },
                        answer: "C",
                        explanation: "‡¶®‡¶ø‡¶â‡¶ü‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ó‡¶§‡¶ø‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶ú‡¶°‡¶º‡¶§‡¶æ‡¶∞ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßá ‡¶™‡¶∞‡¶ø‡¶ö‡¶ø‡¶§",
                        difficulty: "easy",
                        marks: 1
                    },
                    {
                        id: 2,
                        title: "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶ï‡¶æ‡¶∞?",
                        description: "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®",
                        options: {
                            A: "‡¶®‡¶ø‡¶â‡¶ü‡¶®",
                            B: "‡¶Ü‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶®",
                            C: "‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶≤‡¶ø‡¶ì",
                            D: "‡¶ï‡ßá‡¶™‡¶≤‡¶æ‡¶∞"
                        },
                        answer: "A",
                        explanation: "‡¶≠‡¶∞‡¶¨‡ßá‡¶ó‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶â‡¶ü‡¶®‡ßá‡¶∞",
                        difficulty: "medium",
                        marks: 1
                    }
                ]
            };
            
            const dataStr = JSON.stringify(template, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'mcq_template.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        async function processJsonUpload() {
            if(!currentJsonData) {
                alert("‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®!");
                return;
            }
            
            const classCode = document.getElementById('json_class').value;
            const subject = document.getElementById('json_subject').value;
            const chapter = document.getElementById('json_chapter').value;
            const difficulty = document.getElementById('json_difficulty').value;
            const folder = document.getElementById('json_folder').value;
            const createSet = document.getElementById('json_create_set').checked;
            
            if(!classCode || !subject || !folder) {
                alert("‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ, ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶è‡¶¨‡¶Ç ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!");
                return;
            }
            
            // Show progress
            const progressDiv = document.getElementById('upload-progress');
            const progressBar = document.getElementById('progress-bar');
            const progressPercent = document.getElementById('progress-percent');
            const progressDetails = document.getElementById('progress-details');
            
            progressDiv.classList.remove('hidden');
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            progressDetails.textContent = '‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ...';
            
            let questions = [];
            
            // Extract questions from JSON data
            if(currentJsonData.questions && Array.isArray(currentJsonData.questions)) {
                questions = currentJsonData.questions;
            } else if(currentJsonData.singleMCQs && Array.isArray(currentJsonData.singleMCQs)) {
                questions = currentJsonData.singleMCQs;
            } else {
                alert("JSON-‡¶è ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!");
                progressDiv.classList.add('hidden');
                return;
            }
            
            if(questions.length === 0) {
                alert("JSON-‡¶è ‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶á!");
                progressDiv.classList.add('hidden');
                return;
            }
            
            if(createSet) {
                // Create as MCQ Set
                const setTitle = currentJsonData.setInfo?.title || `${subject} MCQ ‡¶∏‡ßá‡¶ü`;
                const setDescription = currentJsonData.setInfo?.description || `${chapter} ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®`;
                
                const setData = {
                    title: setTitle,
                    type: 'mcq_set',
                    description: setDescription,
                    class: classCode,
                    subject: subject,
                    chapter: chapter || currentJsonData.setInfo?.chapter || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£',
                    difficulty: difficulty,
                    questionCount: questions.length,
                    time: Date.now(),
                    published: true,
                    createdBy: 'JSON Upload'
                };
                
                const setId = `JSON_${Date.now()}`;
                const setPath = `${folder}/${setId}`;
                
                try {
                    // Save set metadata
                    await db.ref(setPath).set(setData);
                    
                    // Save each question
                    let successCount = 0;
                    for(let i = 0; i < questions.length; i++) {
                        const q = questions[i];
                        
                        const questionData = {
                            title: q.title,
                            type: 'mcq',
                            description: q.description || null,
                            class: q.class || classCode,
                            subject: q.subject || subject,
                            chapter: q.chapter || chapter || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£',
                            difficulty: q.difficulty || difficulty,
                            options: q.options,
                            answer: q.answer || 'A',
                            explanation: q.explanation || null,
                            time: Date.now()
                        };
                        
                        await db.ref(setPath).child(`q${i + 1}`).set(questionData);
                        successCount++;
                        
                        // Update progress
                        const progress = ((i + 1) / questions.length) * 100;
                        progressBar.style.width = `${progress}%`;
                        progressPercent.textContent = `${Math.round(progress)}%`;
                        progressDetails.textContent = `‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${i + 1}/${questions.length} ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
                    }
                    
                    // Complete
                    progressBar.style.width = '100%';
                    progressPercent.textContent = '100%';
                    progressDetails.innerHTML = `<span class="text-green-400">‚úÖ ${successCount} ‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</span>`;
                    
                    setTimeout(() => {
                        alert(`‚úÖ MCQ ‡¶∏‡ßá‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ${successCount} ‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
                        progressDiv.classList.add('hidden');
                        resetDropZone();
                        loadClassStats();
                    }, 1000);
                    
                } catch(error) {
                    alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: " + error.message);
                    progressDiv.classList.add('hidden');
                }
                
            } else {
                // Save as individual MCQs
                let successCount = 0;
                const totalQuestions = questions.length;
                
                for(let i = 0; i < totalQuestions; i++) {
                    const q = questions[i];
                    
                    const questionData = {
                        title: q.title,
                        type: 'mcq',
                        description: q.description || null,
                        class: q.class || classCode,
                        subject: q.subject || subject,
                        chapter: q.chapter || chapter || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£',
                        difficulty: q.difficulty || difficulty,
                        options: q.options,
                        answer: q.answer || 'A',
                        explanation: q.explanation || null,
                        time: Date.now(),
                        uploadedBy: 'JSON Upload'
                    };
                    
                    try {
                        await db.ref(folder).push(questionData);
                        successCount++;
                    } catch(error) {
                        console.error("Error saving question:", error);
                    }
                    
                    // Update progress
                    const progress = ((i + 1) / totalQuestions) * 100;
                    progressBar.style.width = `${progress}%`;
                    progressPercent.textContent = `${Math.round(progress)}%`;
                    progressDetails.textContent = `‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${i + 1}/${totalQuestions} ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
                }
                
                // Complete
                progressBar.style.width = '100%';
                progressPercent.textContent = '100%';
                progressDetails.innerHTML = `<span class="text-green-400">‚úÖ ${successCount} ‡¶ü‡¶ø MCQ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</span>`;
                
                setTimeout(() => {
                    alert(`‚úÖ ${successCount} ‡¶ü‡¶ø MCQ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
                    progressDiv.classList.add('hidden');
                    resetDropZone();
                    loadClassStats();
                }, 1000);
            }
        }

        // ============ UTILITY FUNCTIONS ============
        function loadFolders() {
            const folderSelect = document.getElementById('json_folder');
            folderSelect.innerHTML = '<option value="">-- ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option>';
            
            db.ref('qbank').once('value', snapshot => {
                const data = snapshot.val();
                
                if(data) {
                    Object.keys(data).forEach(folder => {
                        if(folder !== '_init') {
                            const path = `qbank/${folder}`;
                            folderSelect.innerHTML += `<option value="${path}">üìÇ ${folder}</option>`;
                        }
                    });
                }
                
                // Add option to create new folder
                folderSelect.innerHTML += `<option value="new">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</option>`;
            });
        }
    </script>
</body>
</html>